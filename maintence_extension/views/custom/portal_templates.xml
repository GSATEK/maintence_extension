<odoo>
    <data>
        <template id="portal_my_home_maintenance_orders" name="Show Maintenance Orders" customize_show="True" inherit_id="portal.portal_my_home" priority="50">
            <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
                <t t-if="request.env.user.has_group('maintence_extension.group_portal_worker') or request.env.user.has_group('maintenance.group_equipment_manager')">
                    <t t-call="portal.portal_docs_entry">
                        <t t-set="title">Órdenes de Mantenimiento</t>
                        <t t-set="url" t-value="'/my/maintenance_orders'"/>
                        <t t-set="placeholder_count" t-value="'maintence_count'"/>
                    </t>
                </t>
            </xpath>
        </template>

        <template id="portal_my_maintenance_orders" name="My Maintenance Orders">
            <t t-call="portal.portal_layout">
                <t t-set="breadcrumbs_searchbar" t-value="True"/>
                <t t-call="portal.portal_searchbar">
                    <t t-set="title">Órdenes de Mantenimiento</t>
                </t>
                <div class="row mb-3">
                    <div class="col-3">
                        <strong>Filtrar por estado: </strong>
                        <select id="state_filter" class="form-control" onchange="window.location.href='?state=' + this.value">
                            <option value="">Todos los estados</option>
                            <t t-foreach="states" t-as="state">
                                <option t-att-value="state.id" t-att-selected="state.id == selected_state">
                                    <t t-esc="state.name"/>
                                </option>
                            </t>
                        </select>
                    </div>
                </div>
                <t t-if="not maintenance_orders">
                    <p>Actualmente usted no cuenta con órdenes de mantenimiento registradas.</p>
                </t>
                <t t-if="maintenance_orders">
                    <t t-call="portal.portal_table">
                        <table class="table rounded mb-0 bg-white o_portal_my_doc_table">
                            <thead>
                                <tr class="active">
                                    <th>Orden de mantenimiento</th>
                                    <th>Fecha</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="maintenance_orders" t-as="order">
                                    <tr>
                                        <td>
                                            <a t-attf-href="/my/maintenance_order/#{order.id}?access_token=#{order.access_token}&amp;{{ keep_query() }}">
                                                <span t-esc="order.name" t-att-title="order.id"/>
                                            </a>
                                        </td>
                                        <td><t t-esc="order.create_date" t-options="{'widget': 'date'}"/></td>
                                        <td><t t-esc="order.stage_id.name"/></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </t>
                </t>
            </t>
        </template>

        <template id="portal_my_maintenance_order" name="My Maintenance Order">
            <t t-call="portal.portal_layout">
                <t t-call="portal.portal_record_layout">
                    <t t-set="card_header">
                        <div class="card-header bg-white">
                            <div class="col-12">
                                <h5 class="d-flex mb-1 mb-md-0 row">
                                    <div class="col-9">
                                        <strong>Orden de mantenimiento:</strong>
                                        <input type="text" t-att-value="maintenance_order.name" name="name" class="form-control" readonly="readonly"/>
                                    </div>
                                </h5>
                            </div>
                        </div>
                    </t>
                    <t t-set="card_body">
                        <form action="#" method="post" id="form_maintence">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <input type="hidden" name="id" t-att-value="maintenance_order.id"/>
                            <div class="row container">
                                <div class="col-12">
                                    <div><strong>Estado: </strong>
                                        <select name="stage_id" class="form-control">
                                            <t t-foreach="maintenance_order.stage_id.search([])" t-as="stage">
                                                <option t-att-value="stage.id" t-att-selected="stage.id == maintenance_order.stage_id.id">
                                                    <t t-esc="stage.name"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                    <div style="margin-top: 30px;"><strong>Horas Invertidas: </strong><input type="number" t-att-value="maintenance_order.duration" name="duration" class="form-control"/></div>
                                    <div style="margin-top: 30px; margin-bottom: 30px;"><strong>Fecha de peticion: </strong><input type="date" t-att-value="maintenance_order.request_date" name="request_date" class="form-control"/></div>
                                    <div><strong>Trabajos realizados: </strong><textarea name="work_done" class="form-control"><t t-esc="maintenance_order.work_done"/></textarea></div>
                                    <div style="margin-top: 30px;"><strong>Materiales usados: </strong><textarea name="materials_used" class="form-control"><t t-esc="maintenance_order.materials_used"/></textarea></div>
                                    <div style="margin-top: 30px;"><strong>Observaciones: </strong><textarea name="observations" class="form-control"><t t-esc="maintenance_order.observations"/></textarea></div>
                                </div>
                            </div>
                            <div class="row container" style="margin-top: 30px; margin-bottom: 30px;">
                                <div class="col-12">
                                    <h5>Tareas</h5>
                                   <div class="table-responsive">
                                        <table class="table table-borderless">
                                            <thead>
                                                <tr>
                                                    <th>Nombre</th>
                                                    <th>Descripción</th>
                                                    <th>Tipo</th>
                                                    <th>Tiempo Estimado</th>
                                                    <th>Estado</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="maintenance_order.task_ids" t-as="task">
                                                    <tr>
                                                        <td><t t-esc="task.name"/></td>
                                                        <td><t t-esc="task.description"/></td>
                                                        <td><t t-esc="task.maintenance_tpye.name"/></td>
                                                        <td><t t-esc="task.time"/></td>
                                                        <td style="display:flex; align-items: center;">
                                                            <label class="form-check-label" style="margin-right: 10px;">Realizado</label>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" t-att-name="'state_' + str(task.id)" t-att-checked="task.state == 'realizado'"/>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="signature-container" style="display: flex; justify-content: space-between;">
                                <div>
                                    <strong>Firma trabajador: </strong>
                                    <div class="signature-field" style="border-bottom: 1px solid #000; margin-bottom: 30px;">
                                        <span
                                                t-field="maintenance_order.worker_signature"
                                                t-options='{"widget": "image", "size": (300, 100)}'
                                                t-att-class="'d-none' if not maintenance_order.worker_signature else ''"
                                        />
                                        <div id="signature-pad">

                                        </div>

                                    </div>
                                    <button type="button" class="btn btn-primary" id="clear-signature-btn">
                                        Limpiar
                                    </button>
                                </div>
                            </div>
                            <div class="row container mt-3">
                                <div class="col-12">
                                    <button type="button" class="btn btn-primary" id="sheet_submit_button" t-att-maintence-id="maintenance_order.id">Guardar</button>
                                </div>
                            </div>
                        </form>
                    </t>
                </t>
            </t>
        </template>
       <template id="maintence_extension.portal_my_maintenance_order_readonly" name="My Maintenance Order Readonly">
            <t t-call="portal.portal_layout">
                <t t-call="portal.portal_record_layout">
                    <t t-set="card_header">
                        <div class="card-header bg-white">
                            <div class="col-12">
                                <h5 class="d-flex mb-1 mb-md-0 row">
                                    <div class="col-9">
                                        <strong>Orden de mantenimiento:</strong>
                                        <input type="text" t-att-value="maintenance_order.name" name="name" class="form-control" readonly="readonly"/>
                                    </div>
                                </h5>
                            </div>
                        </div>
                    </t>
                    <t t-set="card_body">
                        <form action="#" method="post" id="form_maintence" readonly="readonly">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <input type="hidden" name="id" t-att-value="maintenance_order.id"/>
                            <div class="row container">
                                <div class="col-12">
                                    <div><strong>Estado: </strong>
                                        <select name="stage_id" class="form-control" disabled="disabled">
                                            <t t-foreach="maintenance_order.stage_id.search([])" t-as="stage">
                                                <option t-att-value="stage.id" t-att-selected="stage.id == maintenance_order.stage_id.id">
                                                    <t t-esc="stage.name"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                    <div style="margin-top: 30px; margin-bottom: 30px;"><strong>Fecha de peticion: </strong><input type="date" t-att-value="maintenance_order.request_date" name="request_date" class="form-control" readonly="readonly"/></div>
                                    <div><strong>Horas Invertidas: </strong><input type="number" t-att-value="maintenance_order.duration" name="duration" class="form-control" readonly="readonly"/></div>
                                    <div style="margin-top: 30px;"><strong>Trabajos realizados: </strong><textarea name="work_done" class="form-control" readonly="readonly"><t t-esc="maintenance_order.work_done"/></textarea></div>
                                    <div style="margin-top: 30px;"><strong>Materiales usados: </strong><textarea name="materials_used" class="form-control" readonly="readonly"><t t-esc="maintenance_order.materials_used"/></textarea></div>
                                    <div style="margin-top: 30px;"><strong>Observaciones: </strong><textarea name="observations" class="form-control" readonly="readonly"><t t-esc="maintenance_order.observations"/></textarea></div>
                                </div>
                            </div>
                            <div class="row container" style="margin-top: 30px; margin-bottom: 30px;">
                                <div class="col-12">
                                    <h5>Tareas</h5>
                                  <div class="table-responsive">
                                    <table class="table table-borderless">
                                        <thead>
                                            <tr>
                                                <th>Nombre</th>
                                                <th>Descripción</th>
                                                <th>Tipo</th>
                                                <th>Tiempo Estimado</th>
                                                <th>Estado</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="maintenance_order.task_ids" t-as="task">
                                                <tr>
                                                    <td><t t-esc="task.name"/></td>
                                                    <td><t t-esc="task.description"/></td>
                                                    <td><t t-esc="task.maintenance_tpye.name"/></td>
                                                    <td><t t-esc="task.time"/></td>
                                                    <td style="display:flex; align-items: center;">
                                                        <label class="form-check-label" style="margin-right: 10px;">Realizado</label>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" t-att-name="'state_' + str(task.id)" t-att-checked="task.state == 'realizado'"/>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 col-12">
                                    <div>
                                        <strong>Firma cliente: </strong>
                                        <t t-if="not maintenance_order.client_signature">
                                            <div id="signature-pad"></div>
                                        </t>
                                        <div class="signature-field" style="border-bottom: 1px solid #000; margin-bottom: 30px;">
                                            <span
                                                    t-field="maintenance_order.client_signature"
                                                    t-options='{"widget": "image", "size": (300, 100)}'
                                                    t-att-class="'d-none' if not maintenance_order.client_signature else ''"
                                            />
                                        </div>
                                        <t t-if="not maintenance_order.client_signature">
                                            <button type="button" class="btn btn-primary" id="clear-signature-btn">
                                                Limpiar
                                            </button>
                                        </t>
                                    </div>
                                </div>
                                <div class="col-md-6 col-12">
                                    <div>
                                        <strong>Firma trabajador:</strong>
                                        <div class="signature-field" style="border-bottom: 1px solid #000; margin-bottom: 30px;">
                                             <span
                                                t-field="maintenance_order.worker_signature"
                                                t-options='{"widget": "image", "size": (300, 100)}'
                                                t-att-class="'d-none' if not maintenance_order.worker_signature else ''"
                                             />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row container mt-3">
                                <t t-if="not maintenance_order.client_signature">
                                    <div class="col-12">
                                        <button type="button" class="btn btn-primary" id="sheet_submit_button" t-att-maintence-id="maintenance_order.id">Guardar</button>
                                    </div>
                                </t>
                            </div>
                        </form>
                    </t>
                </t>
            </t>
        </template>
    </data>
</odoo>